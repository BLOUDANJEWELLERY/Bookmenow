<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel â€“ BookMeNow</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="icon" type="image/png" href="images/favicon.PNG">
  
 <style>
    .admin-main {
      max-width: 900px;
      margin: 1rem auto;
      padding: 1.5rem;
    }

  h1 {
    text-align: center;
    font-size: 2rem;
    color: #003366;
    margin-bottom: 2.2rem;
  }

.filters {
  display: flex;
  flex-wrap: wrap;
  gap: 1.2rem;
  justify-content: center;
  margin-bottom: 3rem;
  background: #f7fbff;
  padding: 1rem 1.5rem;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0, 123, 255, 0.1);
}

.filters select {
  padding: 0.75rem 1.5rem;
  font-size: 1.05rem;
  border-radius: 10px;
  border: 2.5px solid #007bff;
  background: #eaf6ff;
  color: #003366;
  box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15);
  transition: border-color 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
  cursor: pointer;
  min-width: 180px;
  font-weight: 600;
}

.filters select:hover {
  border-color: #0056b3;
  box-shadow: 0 6px 15px rgba(0, 86, 179, 0.25);
}

.filters select:focus {
  border-color: #00bfff;
  background: #d0e9ff;
  outline: none;
  box-shadow: 0 0 8px 3px rgba(0, 191, 255, 0.4);
}


  .booking-card {
    background: linear-gradient(#f2fbff, #f2fbff), 
                linear-gradient(135deg, #007bff, #00c6ff);
    background-clip: padding-box, border-box;
    background-origin: border-box;
    padding: 1.4rem 1.6rem;
    border-radius: 12px;
    margin-bottom: 1.6rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    line-height: 1.6;
    border: 3px solid transparent;
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  .booking-card.done {
    opacity: 0.6;
    transform: scale(0.97);
    filter: grayscale(0.2);
  }

  .booking-card h3 {
    margin-top: 0;
    margin-bottom: 0.5rem;
    font-size: 1.3rem;
    color: var(--accent);
  }

  .card-actions {
    margin-top: 1.2rem;
    display: flex;
    justify-content: flex-end;
    gap: 0.8rem;
  }

  .btn-mark-done {
    background: linear-gradient(to right, #28a745, #5dd99c);
    color: white;
    padding: 0.6rem 1.4rem;
    border: none;
    border-radius: 30px;
    font-weight: bold;
    font-size: 0.95rem;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.2s ease;
    box-shadow: 0 3px 8px rgba(40, 167, 69, 0.2);
  }

  .btn-mark-done:hover {
    filter: brightness(1.1);
    transform: scale(1.05);
  }
  .btn-cancel {
  background: linear-gradient(to right, #dc3545, #ff6b6b);
  color: white;
  padding: 0.6rem 1.4rem;
  border: none;
  border-radius: 30px;
  font-weight: bold;
  font-size: 0.95rem;
  cursor: pointer;
  transition: background 0.3s ease, transform 0.2s ease;
  box-shadow: 0 3px 8px rgba(220, 53, 69, 0.2);
}

.btn-cancel:hover {
  filter: brightness(1.1);
  transform: scale(1.05);
}

.confirm-dialog {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.confirm-box {
  background: linear-gradient(to bottom right, #f2fbff, #e9f5ff);
  padding: 1.5rem;
  border-radius: 12px;
  text-align: center;
  max-width: 340px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
  border: 3px solid transparent;
  background-image: linear-gradient(#f2fbff, #f2fbff),
                    linear-gradient(135deg, #007bff, #00c6ff);
  background-origin: border-box;
  background-clip: padding-box, border-box;
}

.confirm-box h3 {
  margin-bottom: 1.2rem;
  color: #003366;
  font-size: 1.3rem;
}

.confirm-box button {
  margin: 0 0.5rem;
  padding: 0.6rem 1.3rem;
  border: none;
  border-radius: 30px;
  font-weight: bold;
  cursor: pointer;
  font-size: 1rem;
  transition: all 0.3s ease;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
}

.confirm-yes {
  background: linear-gradient(to right, #28a745, #5dd99c);
  color: white;
}

.confirm-yes:hover {
  filter: brightness(1.1);
  transform: scale(1.05);
}

.confirm-no {
  background: linear-gradient(to right, #ffc107, #ffdd57);
  color: #333;
}

.confirm-no:hover {
  filter: brightness(1.05);
  transform: scale(1.05);
}
.confirm-yes {
  background: linear-gradient(to right, #28a745, #5dd99c);
  color: white;
}

.confirm-cancel {
  background: linear-gradient(to right, #dc3545, #ff6b6b);
  color: white;
}

  .loading-indicator {
  text-align: center;
  font-size: 1.1rem;
  margin-top: 2rem;
  color: var(--text, #003366);
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% { opacity: 0.5; }
  50% { opacity: 1; }
  100% { opacity: 0.5; }
}

  @media (max-width: 600px) {
    .admin-main {
      padding: 1rem;
    }

    .booking-card {
      padding: 1rem;
    }

    .filters {
      flex-direction: column;
      align-items: center;
    }

    .card-actions {
      justify-content: center;
    }
  }
</style>

</head>
<body>
  <header>
    <nav class="navbar">
      <div class="logo">Grooming Den Admin</div>
       <div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
      <ul class="nav-links" id="nav-links">
        <li><button onclick="window.location.href='admin-settings.html'">Settings</button></li>
         <li><button onclick="window.location.href='index.html'">Home</button></li>
        <li><button onclick="window.location.href='myappointments.html'">My Appointments</button></li>
        <li><button onclick="window.location.href='booking.html'">Booking</button></li>
        <li><button id="logout-btn" class="logout-btn" style="display: none;">Logout</button></li>
      </ul>
    </nav>
  </header>

  <main class="admin-main">
    <h1>ðŸ“‹ All Appointments</h1>

    <div class="filters">
      <select id="date-filter">
        <option value="today">Today</option>
        <option value="upcoming">Future</option>
        <option value="past">Past</option>
        <option value="all">All</option>
      </select>

      <select id="service-filter">
        <option value="all">All Services</option>
        <option value="Beard Cutting">Beard Cutting</option>
        <option value="Haircut">Haircut</option>
        <option value="Facial">Facial</option>
        <option value="Hair coloring">Hair coloring</option>
        <option value="Shaving">Shaving</option>
        <option value="Head Massage">Head Massage</option>
      </select>
    </div>

    <div id="loading-indicator" class="loading-indicator">Loading appointments...</div>
<div id="cards-container" style="display: none;"></div>

  </main>
<div id="confirm-dialog" class="confirm-dialog" style="display: none;">
  <div class="confirm-box">
<h3 id="confirm-message">Are you sure?</h3>
<button class="confirm-yes" id="confirm-yes">Yes</button>

    <button class="confirm-no">No</button>
  </div>
</div>

  <footer>
    <p>Â© 2025 BookMeNow | Managed by WALEED SHEERAZ</p>
  </footer>

  <!-- Firebase & Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
    import { getFirestore, collection, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";


    const firebaseConfig = {
      apiKey: "AIzaSyBmeipVXF09s9Y9TLDMefIroUWcX4KOw-k",
      authDomain: "sampleportfolio-9450c.firebaseapp.com",
      projectId: "sampleportfolio-9450c",
      storageBucket: "sampleportfolio-9450c.appspot.com",
      messagingSenderId: "725347523572",
      appId: "1:725347523572:web:203fa6c32aa6254f02b7a1"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const logoutBtn = document.getElementById("logout-btn");
    const container = document.getElementById("cards-container");
    const dateFilter = document.getElementById("date-filter");
    const serviceFilter = document.getElementById("service-filter");

    let allBookings = [];

const confirmDialog = document.getElementById("confirm-dialog");
const confirmYes = document.querySelector(".confirm-yes");
const confirmNo = document.querySelector(".confirm-no");

let confirmCallback = null;

confirmYes.onclick = () => {
  confirmDialog.style.display = "none";
  if (confirmCallback) confirmCallback();
};

confirmNo.onclick = () => {
  confirmDialog.style.display = "none";
  confirmCallback = null;
};


    onAuthStateChanged(auth, async (user) => {
      if (!user) return window.location.href = "login.html";
      logoutBtn.style.display = "inline-block";
      logoutBtn.onclick = () => signOut(auth).then(() => location.href = "login.html");

      try {
  const snapshot = await getDocs(collection(db, "bookings"));
  allBookings = snapshot.docs.map(docSnap => {
        const data = docSnap.data();
        return {
          id: docSnap.id,
          ...data,
          datetime: new Date(`${data.date}T${data.time}`),
          done: data.done === true
        };
      });

      renderCards();
        document.getElementById("loading-indicator").style.display = "none";
  container.style.display = "block";
} catch (err) {
  document.getElementById("loading-indicator").innerText = "Failed to load appointments.";
}

    });

    dateFilter.onchange = renderCards;
    serviceFilter.onchange = renderCards;

    function renderCards() {
      container.innerHTML = "";
      const now = new Date();
      const dateVal = dateFilter.value;
      const serviceVal = serviceFilter.value;

      let filtered = allBookings.filter(b => {
        const isToday =
          b.datetime.toDateString() === now.toDateString();
        const isPast = b.datetime < now && !isToday;
        const isFuture = b.datetime > now && !isToday;

        const dateMatch =
          dateVal === "all" ||
          (dateVal === "today" && isToday) ||
          (dateVal === "past" && isPast) ||
          (dateVal === "upcoming" && isFuture);

        const serviceMatch = serviceVal === "all" || b.service === serviceVal;

        return dateMatch && serviceMatch;
      });

      // Sort: not done first
      filtered.sort((a, b) => {
        if (a.done && !b.done) return 1;
        if (!a.done && b.done) return -1;
        return a.datetime - b.datetime;
      });

      if (filtered.length === 0) {
        container.innerHTML = "<p style='text-align:center'>No bookings found.</p>";
        return;
      }

      for (const b of filtered) {
        const card = document.createElement("div");
        card.className = `booking-card ${b.done ? "done" : ""}`;
        card.innerHTML = `
  <h3>${b.service}</h3>
  <p><strong>Name:</strong> ${b.name}</p>
  <p><strong>Phone:</strong> ${b.phone}</p>
  <p><strong>Date:</strong> ${b.date}</p>
  <p><strong>Time:</strong> ${b.time}</p>
  <p><strong>Booking ID:</strong> ${b.bookingId}</p>
  <div class="card-actions">
    ${b.done ? "" : `
      <button class="btn-mark-done">Done</button>
      <button class="btn-cancel">Cancel</button>
    `}
  </div>
`;


if (!b.done) {
  const markBtn = card.querySelector(".btn-mark-done");
  const cancelBtn = card.querySelector(".btn-cancel");

  markBtn.onclick = () => {
    document.getElementById("confirm-message").innerText = "Mark this appointment as done?";
    const yesBtn = document.getElementById("confirm-yes");
    yesBtn.classList.remove("confirm-cancel");
    yesBtn.classList.add("confirm-yes");
    confirmCallback = async () => {
      await updateDoc(doc(db, "bookings", b.id), { done: true });
      b.done = true;
      renderCards();
    };
    confirmDialog.style.display = "flex";
  };

  cancelBtn.onclick = () => {
    document.getElementById("confirm-message").innerText = "Do you really want to cancel the appointment?";
    const yesBtn = document.getElementById("confirm-yes");
    yesBtn.classList.remove("confirm-yes");
    yesBtn.classList.add("confirm-cancel");
    confirmCallback = async () => {
      await deleteDoc(doc(db, "bookings", b.id));
      allBookings = allBookings.filter(item => item.id !== b.id);
      renderCards();
    };
    confirmDialog.style.display = "flex";
  };
}



        container.appendChild(card);
      }
    }
  </script>
   <script type="module" src="js/script.js"></script>
 
</body>
</html>